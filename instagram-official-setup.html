<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram API Setup - Official Process for @beffjarker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            line-height: 1.6;
            color: #333;
        }
        .step {
            margin: 30px 0;
            padding: 20px;
            border-left: 4px solid #1877f2;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .step h3 {
            color: #1877f2;
            margin-top: 0;
        }
        .button {
            background: #1877f2;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 6px;
            display: inline-block;
            margin: 10px 0;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }
        .button:hover {
            background: #166fe5;
        }
        .code-box {
            background: #f1f3f4;
            padding: 15px;
            border: 1px solid #dadce0;
            margin: 15px 0;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .input-box {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #dadce0;
            border-radius: 6px;
            font-size: 14px;
        }
        .success {
            border-left-color: #34a853;
            background: #e8f5e8;
        }
        .warning {
            border-left-color: #fbbc04;
            background: #fef7e0;
        }
        .error {
            border-left-color: #ea4335;
            background: #fce8e6;
        }
        .checklist {
            background: #e3f2fd;
            border-left-color: #2196f3;
        }
        ul li {
            margin: 8px 0;
        }
        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <h1>üéØ Instagram API Setup - Official Facebook Process</h1>
    <p>Following the official <a href="https://developers.facebook.com/docs/instagram-platform/instagram-api-with-instagram-login/get-started/" target="_blank">Facebook Instagram API documentation</a></p>

    <div class="step checklist">
        <h3>üìã Prerequisites Checklist</h3>
        <p>Before we start, let's verify you have everything needed:</p>
        <ul>
            <li>‚úÖ Instagram Business or Creator account (@beffjarker)</li>
            <li>‚úÖ Facebook App created (ID: 809266451465053)</li>
            <li>‚úÖ Instagram Basic Display product added to your app</li>
            <li>‚ùì Valid OAuth redirect URIs configured</li>
            <li>‚ùì App Review completed (if needed for production)</li>
        </ul>
    </div>

    <div class="step warning">
        <h3>‚ö†Ô∏è Important: Check Your Facebook App Configuration</h3>
        <p>First, let's verify your Facebook App is properly configured:</p>
        <ol>
            <li>Go to <a href="https://developers.facebook.com/apps/809266451465053/dashboard/" target="_blank">Your Facebook App Dashboard</a></li>
            <li>Click on <strong>"Instagram Basic Display"</strong> in the left sidebar</li>
            <li>Verify these settings:</li>
        </ol>

        <div class="code-box">
Valid OAuth Redirect URIs should include:
- https://localhost:3001/auth/instagram/callback
- https://httpbin.org/get
- http://localhost:4200/auth/callback
        </div>

        <button class="button" onclick="window.open('https://developers.facebook.com/apps/809266451465053/instagram-basic-display/basic-display/', '_blank')">
            üîß Configure App Settings
        </button>
    </div>

    <div class="step">
        <h3>Step 1: Add Instagram Test User</h3>
        <p>Since you're accessing @beffjarker's content, you need to add this account as a test user:</p>
        <ol>
            <li>In your Facebook App, go to <strong>Instagram Basic Display > Basic Display</strong></li>
            <li>Scroll to <strong>"Instagram Testers"</strong> section</li>
            <li>Click <strong>"Add Instagram Testers"</strong></li>
            <li>Add <span class="highlight">@beffjarker</span></li>
            <li>The user (@beffjarker) must accept the invitation</li>
        </ol>

        <button class="button" onclick="window.open('https://developers.facebook.com/apps/809266451465053/instagram-basic-display/basic-display/', '_blank')">
            üë• Add Instagram Tester
        </button>
    </div>

    <div class="step">
        <h3>Step 2: Get Authorization Code</h3>
        <p>Once @beffjarker is added as a tester and has accepted, get the authorization:</p>

        <div class="code-box">
Authorization URL:
https://api.instagram.com/oauth/authorize
  ?client_id=809266451465053
  &redirect_uri=https://httpbin.org/get
  &scope=user_profile,user_media
  &response_type=code
        </div>

        <button class="button" onclick="authorizeInstagram()">
            üîê Authorize Instagram Access
        </button>

        <p><small><strong>Important:</strong> Make sure you're logged into Instagram as @beffjarker before clicking!</small></p>
    </div>

    <div class="step">
        <h3>Step 3: Extract Authorization Code</h3>
        <p>After authorization, paste the redirect URL here to extract the code:</p>
        <input type="text" id="redirect-url" class="input-box" placeholder="Paste the complete URL from httpbin.org here...">
        <button class="button" onclick="extractCode()">Extract Code</button>
        <div id="code-result"></div>
    </div>

    <div class="step">
        <h3>Step 4: Exchange Code for Access Token</h3>
        <div id="token-section" style="display: none;">
            <p>Now we'll exchange your authorization code for an access token:</p>
            <button class="button" onclick="getAccessToken()" id="token-button">Get Access Token</button>
            <div id="token-result"></div>
        </div>
    </div>

    <div class="step success" id="final-result" style="display: none;">
        <h3>üéâ Success! Your Access Token</h3>
        <p><strong>Short-lived Access Token:</strong></p>
        <div class="code-box" id="final-token"></div>

        <p><strong>User ID:</strong></p>
        <div class="code-box" id="user-id"></div>

        <h4>Next Steps:</h4>
        <ol>
            <li>Copy the access token above</li>
            <li>Update your .env file:</li>
        </ol>
        <div class="code-box">INSTAGRAM_ACCESS_TOKEN=your_token_here</div>
        <li>Restart your Jouster Full Stack services</li>
        <li>(Optional) Exchange for long-lived token for production use</li>
    </div>

    <div class="step warning" id="troubleshooting">
        <h3>üîß Common Issues & Solutions</h3>
        <ul>
            <li><strong>"Invalid platform app" error:</strong> Check that Instagram Basic Display is enabled in your Facebook app</li>
            <li><strong>"Redirect URI mismatch":</strong> Ensure https://httpbin.org/get is in your Valid OAuth Redirect URIs</li>
            <li><strong>"User not authorized":</strong> Make sure @beffjarker is added as an Instagram Tester and accepted the invitation</li>
            <li><strong>"Invalid client" error:</strong> Verify your App ID and App Secret are correct</li>
        </ul>
    </div>

    <script>
        let authCode = '';

        function authorizeInstagram() {
            const authUrl = 'https://api.instagram.com/oauth/authorize?' +
                'client_id=809266451465053&' +
                'redirect_uri=https://httpbin.org/get&' +
                'scope=user_profile,user_media&' +
                'response_type=code';

            window.open(authUrl, '_blank');
        }

        function extractCode() {
            const url = document.getElementById('redirect-url').value;
            console.log('Extracting code from URL:', url);

            // Try different URL formats
            let codeMatch = url.match(/[?&]code=([^&]+)/);

            if (!codeMatch) {
                // Try without URL encoding
                codeMatch = url.match(/code[=:]([^&\s,}]+)/);
            }

            if (codeMatch) {
                authCode = decodeURIComponent(codeMatch[1]);
                document.getElementById('code-result').innerHTML = `
                    <div style="background: #d4edda; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        ‚úÖ Authorization code extracted successfully!<br>
                        <strong>Code:</strong> <code>${authCode}</code>
                    </div>
                `;
                document.getElementById('token-section').style.display = 'block';
            } else {
                document.getElementById('code-result').innerHTML = `
                    <div style="background: #f8d7da; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        ‚ùå Could not find authorization code in the URL.<br>
                        <strong>Make sure you:</strong><br>
                        ‚Ä¢ Copied the entire URL from httpbin.org<br>
                        ‚Ä¢ The URL contains "code=" parameter<br>
                        ‚Ä¢ You completed the Instagram authorization step
                    </div>
                `;
                console.log('No code found in URL:', url);
            }
        }

        async function getAccessToken() {
            if (!authCode) {
                alert('Please extract the authorization code first!');
                return;
            }

            const button = document.getElementById('token-button');
            button.disabled = true;
            button.textContent = 'Getting token...';

            try {
                console.log('Requesting access token with code:', authCode);

                const formData = new FormData();
                formData.append('client_id', '809266451465053');
                formData.append('client_secret', '4e73f8b81f0d7c3fa7eb39c42c6d39b1');
                formData.append('grant_type', 'authorization_code');
                formData.append('redirect_uri', 'https://httpbin.org/get');
                formData.append('code', authCode);

                const response = await fetch('https://api.instagram.com/oauth/access_token', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                console.log('Token response:', data);

                if (data.access_token) {
                    document.getElementById('final-token').textContent = data.access_token;
                    document.getElementById('user-id').textContent = data.user_id || 'Not provided';
                    document.getElementById('final-result').style.display = 'block';
                    document.getElementById('token-result').innerHTML = `
                        <div style="background: #d4edda; padding: 15px; border-radius: 6px; margin: 15px 0;">
                            ‚úÖ Access token obtained successfully! Scroll down to see it.
                        </div>
                    `;
                } else {
                    throw new Error(data.error_message || data.error || 'Failed to get access token');
                }
            } catch (error) {
                console.error('Token error:', error);
                document.getElementById('token-result').innerHTML = `
                    <div style="background: #f8d7da; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        ‚ùå Error: ${error.message}<br>
                        <strong>Common causes:</strong><br>
                        ‚Ä¢ Authorization code expired (codes expire after 10 minutes)<br>
                        ‚Ä¢ Code already used (each code can only be used once)<br>
                        ‚Ä¢ App configuration issues<br>
                        ‚Ä¢ Network/CORS issues<br><br>
                        <strong>Try:</strong> Get a fresh authorization code by clicking the authorize button again.
                    </div>
                `;
            }

            button.disabled = false;
            button.textContent = 'Get Access Token';
        }

        // Auto-extract code if present in URL
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            if (code) {
                document.getElementById('redirect-url').value = window.location.href;
                extractCode();
            }
        };
    </script>
</body>
</html>
